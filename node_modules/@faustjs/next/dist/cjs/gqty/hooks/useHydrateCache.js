"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.create = void 0;
const react_1 = require("react");
const isString_1 = __importDefault(require("lodash/isString"));
const isObject_1 = __importDefault(require("lodash/isObject"));
const isFunction_1 = __importDefault(require("lodash/isFunction"));
function create(useClient) {
    return ({ cacheSnapshot, shouldRefetch }) => {
        const snapshotCache = (0, react_1.useRef)('');
        const { client } = useClient();
        if ((0, isString_1.default)(cacheSnapshot) && snapshotCache.current !== cacheSnapshot) {
            snapshotCache.current = cacheSnapshot;
            client.hydrateCache({ cacheSnapshot, shouldRefetch: false });
        }
        (0, react_1.useEffect)(() => {
            if (!(0, isObject_1.default)(client) || !(0, isFunction_1.default)(client.refetch)) {
                return;
            }
            if (shouldRefetch) {
                client.refetch(client.query).catch(console.error);
            }
        }, [shouldRefetch, client]);
    };
}
exports.create = create;
